<view class="container page-detail">
  <!-- 1. è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="detail-nav" style="height: {{navTotalHeight}}px;">
    <!-- å¯¼èˆªå†…å®¹åŒºï¼šå‚ç›´å®šä½åˆ°èƒ¶å›Šä½ç½® -->
    <view class="nav-content-wrapper" style="top: {{navContentTop}}px; height: {{navContentHeight}}px;">
      
      <view class="nav-left" bindtap="onNavBack">
        <view class="icon-back"></view>
      </view>
      
      <view class="nav-center user-mini-profile">
        <image class="mini-avatar" src="{{post.userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <text class="mini-name">{{post.userInfo.nickname}}</text>
        <view class="mini-follow-btn {{post.userInfo.isFollowed ? 'followed' : ''}}" catchtap="toggleFollow" wx:if="{{!post.userInfo.isFollowed}}">
          å…³æ³¨
        </view>
      </view>
      
      <!-- å³ä¾§ç©ºå‡ºä½ç½®ç»™èƒ¶å›Š -->
      <view class="nav-right-placeholder"></view>

    </view>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒº -->
  <scroll-view 
    scroll-y 
    class="detail-scroll" 
    style="padding-top: {{navTotalHeight}}px; padding-bottom: calc(120rpx + env(safe-area-inset-bottom));"
  >
    
    <!-- 2. å›¾ç‰‡è½®æ’­ -->
    <view class="media-swiper-wrapper">
      <swiper 
        class="media-swiper" 
        bindchange="onSwiperChange"
        circular
      >
        <block wx:for="{{post.images}}" wx:key="*this">
          <swiper-item>
            <image 
              src="{{item}}" 
              mode="aspectFill" 
              class="swiper-img" 
              bindtap="onPreviewImage" 
              data-src="{{item}}"
            />
          </swiper-item>
        </block>
      </swiper>
      
      <!-- æŒ‡ç¤ºç‚¹ -->
      <view class="swiper-indicator" wx:if="{{post.images.length > 1}}">
        <view 
          wx:for="{{post.images}}" 
          wx:key="*this" 
          class="dot {{index === swiperCurrent ? 'active' : ''}}"
        ></view>
      </view>
    </view>

    <!-- 3. å†…å®¹ä¸»ä½“ -->
    <view class="content-body">
      <view class="post-title">{{post.title}}</view>
      
      <text class="post-text" user-select>{{post.content}}</text>
      
      <view class="post-tags">
        <text class="tag-item">#åŒ—ä¸­åŒ»</text>
        <text class="tag-item">#ç§‹å¤©</text>
      </view>

      <view class="post-meta-row">
        <text class="meta-date">{{post.createTime}} Â· {{post.location}}</text>
      </view>

      <view class="divider-line"></view>
    </view>

    <!-- 4. è¯„è®ºåŒº -->
    <view class="comments-section">
      <view class="comments-header">å…± {{post.stats.comments}} æ¡è¯„è®º</view>
      
      <view class="comment-list" wx:if="{{comments.length > 0}}">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <image class="c-avatar" src="{{item.avatar || '/images/default-avatar.png'}}"></image>
          <view class="c-content">
            <view class="c-name">{{item.nickname}}</view>
            <view class="c-text">
              {{item.content}} 
              <text class="c-time">{{item.time}}</text>
            </view>
          </view>
          <view class="c-like">
            <view class="icon-heart-outline">â™¡</view>
          </view>
        </view>
      </view>

      <!-- ç©ºè¯„è®ºå ä½ -->
      <view class="empty-comments" wx:else>
        <text>è¿˜æ²¡æœ‰è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</text>
      </view>
    </view>

  </scroll-view>

  <!-- 5. åº•éƒ¨å›ºå®šæ“ä½œæ  -->
  <view class="footer-bar">
    <view class="input-wrapper" bindtap="onFocusComment">
      <view class="icon-edit">âœ</view>
      <text class="placeholder-text">è¯´ç‚¹ä»€ä¹ˆ...</text>
    </view>

    <view class="action-group">
      <view class="action-item" bindtap="toggleLike">
        <view class="icon-heart {{post.stats.isLiked ? 'active' : ''}}">
          {{post.stats.isLiked ? 'â™¥' : 'â™¡'}}
        </view>
        <text class="action-count">{{post.stats.likes || 'ç‚¹èµ'}}</text>
      </view>

      <view class="action-item" bindtap="toggleStar">
        <view class="icon-star {{post.stats.isStarred ? 'active' : ''}}">
          {{post.stats.isStarred ? 'â˜…' : 'â˜†'}}
        </view>
        <text class="action-count">{{post.stats.stars || 'æ”¶è—'}}</text>
      </view>

      <view class="action-item">
        <view class="icon-comment">ğŸ’¬</view>
        <text class="action-count">{{post.stats.comments || 'è¯„è®º'}}</text>
      </view>
    </view>
  </view>

  <!-- è¯„è®ºè¾“å…¥å¼¹çª— -->
  <view class="comment-popup-mask" wx:if="{{focusInput}}" bindtap="closeInput" catchtouchmove="true"></view>
  <view class="comment-input-panel" wx:if="{{focusInput}}" style="bottom: {{focusInput ? 0 : '-100%'}}">
    <textarea 
      class="real-input" 
      placeholder="å‹å–„è¯„è®ºï¼Œæ¸©æš–äººå¿ƒ" 
      focus="{{focusInput}}" 
      cursor-spacing="20"
      bindinput="onInputChange"
      value="{{inputValue}}"
      show-confirm-bar="{{false}}"
      adjust-position="{{true}}" 
    ></textarea>
    <view class="send-btn" bindtap="onSendComment">å‘é€</view>
  </view>

</view>
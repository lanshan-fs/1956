<view class="container page-detail {{type}}">
  <!-- 1. è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="detail-nav" style="height: {{navTotalHeight}}px;">
    <!-- å¯¼èˆªå†…å®¹åŒºï¼šå‚ç›´å®šä½åˆ°èƒ¶å›Šä½ç½® -->
    <view class="nav-content-wrapper" style="top: {{navContentTop}}px; height: {{navContentHeight}}px;">
      
      <view class="nav-left" bindtap="onNavBack">
        <view class="icon-back"></view>
      </view>
      
      <view class="nav-center user-mini-profile" wx:if="{{type === 'post'}}">
        <image class="mini-avatar" src="{{post.userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <text class="mini-name">{{post.userInfo.nickname}}</text>
        <view class="mini-follow-btn {{post.userInfo.isFollowed ? 'followed' : ''}}" catchtap="toggleFollow" wx:if="{{!post.userInfo.isFollowed}}">
          å…³æ³¨
        </view>
      </view>

      <!-- é›†å¸‚æ¨¡å¼å¯¼èˆªæ ï¼šå¢åŠ æœç´¢å…¥å£ -->
      <view class="nav-center market-nav-title" wx:else>
        <view class="search-icon-btn" bindtap="onSearch">
          <icon type="search" size="18" color="#1A1A1A"/>
        </view>
        <text class="nav-title-text">é—²ç½®è¯¦æƒ…</text>
      </view>
      
      <!-- å³ä¾§ç©ºå‡ºä½ç½®ç»™èƒ¶å›Š -->
      <view class="nav-right-placeholder"></view>

    </view>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒº -->
  <scroll-view 
    scroll-y 
    class="detail-scroll" 
    style="padding-top: {{navTotalHeight}}px; padding-bottom: calc(140rpx + env(safe-area-inset-bottom));"
  >
    
    <!-- 2. å›¾ç‰‡è½®æ’­ (å°çº¢ä¹¦å¼) -->
    <view class="media-swiper-wrapper">
      <swiper 
        class="media-swiper" 
        bindchange="onSwiperChange"
        circular
      >
        <block wx:for="{{post.images}}" wx:key="*this">
          <swiper-item>
            <image 
              src="{{item}}" 
              mode="aspectFill" 
              class="swiper-img" 
              bindtap="onPreviewImage" 
              data-src="{{item}}"
            />
          </swiper-item>
        </block>
      </swiper>
      
      <!-- æŒ‡ç¤ºç‚¹ -->
      <view class="swiper-indicator" wx:if="{{post.images.length > 1}}">
        <view 
          wx:for="{{post.images}}" 
          wx:key="*this" 
          class="dot {{index === swiperCurrent ? 'active' : ''}}"
        ></view>
      </view>
    </view>

    <!-- 3. å†…å®¹ä¸»ä½“ -->
    <view class="content-body">
      
      <!-- é›†å¸‚ä¸“å±ï¼šå–å®¶ä¿¡æ¯ & ä»·æ ¼ -->
      <block wx:if="{{type === 'market'}}">
        <view class="market-seller-row" bindtap="onSellerHome">
          <image class="seller-avatar" src="{{post.userInfo.avatar || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="seller-info">
            <view class="seller-name">{{post.userInfo.nickname}}</view>
            <view class="seller-last-seen">{{post.userInfo.lastSeen}}</view>
          </view>
          <view class="seller-arrow">ã€‰</view>
        </view>
        
        <view class="market-price-row">
          <text class="price-label">ç†æƒ³ä»·</text>
          <text class="currency">Â¥</text>
          <text class="price-value">{{post.price}}</text>
        </view>
      </block>

      <view class="post-title">{{post.title}}</view>
      
      <text class="post-text" user-select>{{post.content}}</text>
      
      <view class="post-tags" wx:if="{{type === 'post'}}">
        <text class="tag-item">#åŒ—ä¸­åŒ»</text>
        <text class="tag-item">#ç§‹å¤©</text>
      </view>

      <view class="post-meta-row">
        <text class="meta-date">{{post.createTime}} Â· {{post.location}}</text>
        <text class="meta-views" wx:if="{{type === 'market'}}">{{post.stats.views}}äººæµè§ˆ</text>
      </view>

      <view class="divider-line"></view>
    </view>

    <!-- 4. è¯„è®º/ç•™è¨€åŒº -->
    <view class="comments-section">
      <view class="comments-header">
        {{type === 'market' ? 'ç•™è¨€' : 'è¯„è®º'}} Â· {{post.stats.comments}}
      </view>
      
      <view class="comment-list" wx:if="{{comments.length > 0}}">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <image class="c-avatar" src="{{item.avatar || '/images/default-avatar.png'}}"></image>
          <view class="c-content">
            <view class="c-name">{{item.nickname}}</view>
            <view class="c-text">
              {{item.content}} 
              <view class="c-time">{{item.time}}</view>
            </view>
          </view>
          <view class="c-like" wx:if="{{type === 'post'}}">
            <view class="icon-heart-outline">â™¡</view>
          </view>
        </view>
      </view>

      <view class="empty-comments" wx:else>
        <text>è¿˜æ²¡æœ‰{{type === 'market' ? 'ç•™è¨€' : 'è¯„è®º'}}å“¦~</text>
      </view>
    </view>

  </scroll-view>

  <!-- 5. åº•éƒ¨å›ºå®šæ“ä½œæ  -->
  <view class="footer-bar">
    <!-- å‘å¸ƒç•™è¨€/è¯„è®ºè¾“å…¥æ¡† -->
    <view class="input-wrapper" bindtap="onFocusComment">
      <view class="icon-edit">âœ</view>
      <text class="placeholder-text">{{type === 'market' ? 'é—®é—®å–å®¶æ›´å¤šç»†èŠ‚...' : 'è¯´ç‚¹ä»€ä¹ˆ...'}}</text>
    </view>

    <view class="action-group">
      <!-- åªæœ‰åŠ¨æ€è¯¦æƒ…æ˜¾ç¤ºç‚¹èµ -->
      <view class="action-item" bindtap="toggleLike" wx:if="{{type === 'post'}}">
        <view class="icon-heart {{post.stats.isLiked ? 'active' : ''}}">
          {{post.stats.isLiked ? 'â™¥' : 'â™¡'}}
        </view>
        <text class="action-count">{{post.stats.likes || 'ç‚¹èµ'}}</text>
      </view>

      <view class="action-item" bindtap="toggleStar">
        <view class="icon-star {{post.stats.isStarred ? 'active' : ''}}">
          {{post.stats.isStarred ? 'â˜…' : 'â˜†'}}
        </view>
        <text class="action-count">{{post.stats.stars || 'æ”¶è—'}}</text>
      </view>

      <!-- åŠ¨æ€è¯¦æƒ…æ˜¾ç¤ºè¯„è®ºå›¾æ ‡ -->
      <view class="action-item" wx:if="{{type === 'post'}}">
        <view class="icon-comment">ğŸ’¬</view>
        <text class="action-count">{{post.stats.comments || 'è¯„è®º'}}</text>
      </view>

      <!-- é›†å¸‚è¯¦æƒ…æ˜¾ç¤ºâ€œè”ç³»å¯¹æ–¹â€æŒ‰é’® (Neobrutalism Button) -->
      <view class="contact-btn" wx:if="{{type === 'market'}}" bindtap="onContact">
        è”ç³»å¯¹æ–¹
      </view>
    </view>
  </view>

  <!-- è¯„è®ºè¾“å…¥å¼¹çª— -->
  <view class="comment-popup-mask" wx:if="{{focusInput}}" bindtap="closeInput" catchtouchmove="true"></view>
  <view class="comment-input-panel" wx:if="{{focusInput}}" style="bottom: {{focusInput ? 0 : '-100%'}}">
    <textarea 
      class="real-input" 
      placeholder="{{type === 'market' ? 'åœ¨æ­¤ç»™å–å®¶ç•™è¨€' : 'å‹å–„è¯„è®ºï¼Œé‡åœ¨ä¸­åŒ»'}}" 
      focus="{{focusInput}}" 
      cursor-spacing="20"
      bindinput="onInputChange"
      value="{{inputValue}}"
      show-confirm-bar="{{false}}"
      adjust-position="{{true}}" 
    ></textarea>
    <view class="send-btn" bindtap="onSendComment">å‘é€</view>
  </view>

</view>